const cloud = require('wx-server-sdk')
cloud.init()
//引入发送邮件的类库
var nodemailer = require('nodemailer')
// 创建一个SMTP客户端配置
var config = {
  host: 'smtp.163.com', //网易163邮箱 smtp.163.com
  port: 465, //网易邮箱端口 25
  auth: {
    user: 'mstation0729@163.com', //邮箱账号
    pass: 'EOVHYEVBTHEYXPIM' //邮箱的授权码
  }
};
// 创建一个SMTP客户端对象
var transporter = nodemailer.createTransport(config);
// 云函数入口函数
exports.main = async(event, context) => {
  // 创建一个邮件对象
  var mail = {
    // 发件人
    from: 'mstation0729@163.com',
    // 主题
    subject: '欢迎到访上海鸣锣科技有限公司',
    // 收件人
    to: event.visitorEmail,
    // 邮件内容，text或者html格式
    text: '', //可以是链接，也可以是验证码
    html: "<meta charset='utf-8'><table width='100%'><tr><td style='width: 100%;'><center><table class='content-wrap'style='margin: 0px auto; width: 600px;'><tr><td style='margin: 0px auto; overflow: hidden; padding: 0px; border: 0px dotted rgb(238, 238, 238);'><!----><div class='full'tindex='1'style='margin: 0px auto; max-width: 600px;'><table align='center'border='0'cellpadding='0'cellspacing='0'class='fullTable'style='width: 600px;'><tbody><tr><td class='fullTd'style='direction: ltr; width: 600px; font-size: 0px; padding-bottom: 0px; text-align: center; vertical-align: top;'><div style='display: inline-block; vertical-align: top; width: 100%;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='vertical-align: top;'><tr><td style='font-size: 0px; word-break: break-word; width: 580px; text-align: center; padding: 10px;'><div><img alt='访客头像'src='"+event.visitorPhoto+"' style='box-sizing: border-box; border-radius: 50%; border: 0px; display: inline-block; outline: none; text-decoration: none; height: 400px; width: 400px; padding: 0px;'></div></td></tr></table></div></td></tr></tbody></table></div><div class='full'tindex='2'style='margin: 0px auto; max-width: 600px;'><table align='center'border='0'cellpadding='0'cellspacing='0'class='fullTable'style='width: 600px;'><tbody><tr><td class='fullTd'style='direction: ltr; width: 600px; font-size: 0px; padding-bottom: 0px; text-align: center; vertical-align: top; background-image: url(&quot;&quot;); background-repeat: no-repeat; background-size: 100px; background-position: 10% 50%;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='vertical-align: top;'><tr><td align='left'style='font-size: 0px; padding: 20px;'><div class='text'style='font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; overflow-wrap: break-word; margin: 0px; text-align: center; line-height: 1.6; color: rgb(41, 41, 41); font-size: 14px; font-weight: normal;'><div><p style='text-size-adjust: none; word-break: break-word; line-height: 1.6; font-size: 14px; margin: 0px;'><strong><span style='font-size: 20px; background-color: #ffffff; font-family: arial, helvetica, sans-serif;'>&nbsp;尊敬的"+event.visitorName+"先生/女士，感谢您于"+event.visitData+"到访我们公司，欢迎您下次光临！</span></strong></p></div></div></td></tr></table></td></tr></tbody></table></div><div class='full'tindex='3'style='margin: 0px auto; max-width: auto;'><table align='center'border='0'cellpadding='0'cellspacing='0'class='fullTable'style='width: auto;'><tbody><tr><td class='fullTd'style='direction: ltr; width: auto; font-size: 0px; padding-bottom: 0px; text-align: center; vertical-align: top;'><div style='display: inline-block; vertical-align: top; width: 100%;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='vertical-align: top;'><tr><td style='font-size: 0px; word-break: break-word; width: auto; text-align: center; padding: 10px;'><div><img height='auto'alt='签名NDA'width='auto'src='"+ event.ndaSignPath+"' style='box-sizing: border-box; border: 0px; display: inline-block; outline: none; text-decoration: none; height: auto; width: auto; padding: 0px;'></div></td></tr></table></div></td></tr></tbody></table></div><div tindex='4'style='margin: 0px auto; max-width: 600px;'><table align='center'border='0'cellpadding='0'cellspacing='0'style='background-color: rgb(255, 255, 255); background-image: url(&quot;&quot;); background-repeat: no-repeat; background-size: 100px; background-position: 1% 50%;'><tbody><tr><td style='direction: ltr; font-size: 0px; text-align: center; vertical-align: top; width: 600px;'><table width='100%'border='0'cellpadding='0'cellspacing='0'style='vertical-align: top;'><tbody><tr><td class='oneColumn column1'style='width: 100%; max-width: 100%; min-height: 1px; font-size: 13px; text-align: left; direction: ltr; vertical-align: top; padding: 0px;'><div columnnumber='1'><table align='center'border='0'cellpadding='0'cellspacing='0'style='width: 100%;'><tbody><tr><td style='direction: ltr; font-size: 0px; text-align: center; vertical-align: top; border: 0px;'><div class='mj-column-per-50'style='width: 100%; max-width: 100%; font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='border-collapse: collapse; border-spacing: 0px; width: 100%; vertical-align: top;'><tr><td align='center'border='0'style='font-size: 0px; word-break: break-word;'><div class='full'style='margin: 0px auto; max-width: 600px;'><table align='center'border='0'cellpadding='0'cellspacing='0'class='fullTable'style='width: 600px;'><tbody><tr><td class='fullTd'style='direction: ltr; width: 600px; font-size: 0px; padding-bottom: 0px; text-align: center; vertical-align: top; background-image: url(&quot;&quot;); background-repeat: no-repeat; background-size: 100px; background-position: 10% 50%;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='vertical-align: top;'><tr><td align='left'style='font-size: 0px; padding: 8px 20px;'><div class='text'style='font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; overflow-wrap: break-word; margin: 0px; text-align: center; line-height: 20px; color: rgb(51, 51, 51); font-size: 14px; font-weight: bolder;'><div><p style='text-size-adjust: none; word-break: break-word; line-height: 20px; font-size: 14px; margin: 0px;'><span style='font-size: 24px;'>公司来访事由："+event.cause+"</span></p></div></div></td></tr></table></td></tr></tbody></table></div></td></tr></table></div><div class='mj-column-per-50'style='width: 100%; max-width: 100%; font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='border-collapse: collapse; border-spacing: 0px; width: 100%; vertical-align: top;'><tr><td align='center'border='0'style='font-size: 0px; word-break: break-word;'><div class='full'style='margin: 0px auto; max-width: 600px;'><table align='center'border='0'cellpadding='0'cellspacing='0'class='fullTable'style='width: 600px;'><tbody><tr><td class='fullTd'style='direction: ltr; width: 600px; font-size: 0px; padding-bottom: 0px; text-align: center; vertical-align: top; background-image: url(&quot;&quot;); background-repeat: no-repeat; background-size: 100px; background-position: 10% 50%;'><table border='0'cellpadding='0'cellspacing='0'width='100%'style='vertical-align: top;'><tr><td align='left'style='font-size: 0px; padding: 0px 15px 15px;'><div class='text'style='font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; overflow-wrap: break-word; margin: 0px; text-align: center; line-height: 24px; color: rgb(51, 51, 51); font-size: 14px; font-weight: normal;'><div><p style='text-size-adjust: none; word-break: break-word; line-height: 24px; font-size: 14px; margin: 0px;'>公司联系方式：XXXXXXXXXX</p></div></div></td></tr></table></td></tr></tbody></table></div></td></tr></table></div></td></tr></tbody></table></div></td></tr></tbody></table></td></tr></tbody></table></div></td></tr></table></center></td></tr></table><!---->"
  };

  let res = await transporter.sendMail(mail);
  return res;
}